name: generate-csv-eagles-all-plays

permissions:
  contents: write

on:
  schedule:
    - cron: '30 1 * * *'
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Setup R
        uses: r-lib/actions/setup-r@v2
        with:
          r-version: '4.3.1'

      - name: Install dependencies
        uses: r-lib/actions/setup-r-dependencies@v2
        with:
          extra-packages: |
            nflfastR
            dplyr
            purrr
            readr
            jsonlite
            stringr
            tibble
          cache: true

      - name: Run R script
        run: Rscript scripts/generate_csv_eagles_all_plays.R TRUE

      - name: Commit and push CSV updates
        uses: EndBug/add-and-commit@v9
        with:
          message: "Automated CSV update"
          add: "_data/*.csv assets/data/*.csv"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}