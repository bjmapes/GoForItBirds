---
layout: default
title: Live View
---

<div x-data="live4thDown" x-init="startPolling()" class="live-container">
  <h1>Live 4th Down Decision</h1>
  <template x-if="!isEaglesPlaying">
    <p>No live Birds game right now.</p>
  </template>

  <template x-if="isEaglesPlaying && !lastDecision">
    <p>The Birds are playing.</p>
  </template>

  <template x-if="lastDecision">
    <div class="decision-box">
      <p><strong>Game:</strong> <span x-text="lastDecision.game"></span></p>
      <p><strong>Quarter:</strong> <span x-text="lastDecision.quarter"></span></p>
      <p><strong>Clock:</strong> <span x-text="lastDecision.clock"></span></p>
      <p><strong>Down &amp; Distance:</strong> <span x-text="lastDecision.downDistance"></span></p>
      <p><strong>Recommendation:</strong> <span x-text="lastDecision.recommendation"></span></p>
    </div>
  </template>
</div>

<script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
<script>
  document.addEventListener('alpine:init', () => {
    Alpine.data('live4thDown', () => ({
      lastDecision: null,
      isEaglesPlaying: false,
      intervalMs: 30000,
      startPolling() {
        this.poll();
        setInterval(() => this.poll(), this.intervalMs);
      },
      poll() {
        console.log('Polling...');
        fetch('https://site.api.espn.com/apis/site/v2/sports/football/nfl/scoreboard')
          .then(res => res.json())
          .then(data => {
            const games = data.events || [];
            console.log("Games:", games);
            const eaglesGame = games.find(game =>
              game.competitions?.[0]?.competitors?.some(team => team.team.id === "21")
              && game.competitions[0].status?.type?.state === "in"
            );
            console.log("Eagles Game:", eaglesGame);
            this.isEaglesPlaying = !!eaglesGame;
          });
      }
    }));
  });
</script>